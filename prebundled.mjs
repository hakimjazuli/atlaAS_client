class t{constructor(t,e,i=!1){this.id=t,this.callback=e,this.debounce=i}id;callback;debounce}class e{static timeout=t=>new Promise((e=>setTimeout(e,t)));static is_async=t=>"AsyncFunction"===t.constructor.name}class i{queue={};is_running=!1;assign=t=>{this.push(t),this.is_running||this.run()};push=t=>{const{callback:e,debounce:i}=t;this.queue[t.id]={callback:e,debounce:i}};run=async()=>{for(this.is_running=!0;0!==Object.keys(this.queue).length;)for(const t in this.queue){const{callback:i,debounce:n}=this.queue[t];if(delete this.queue[t],n&&await e.timeout(n),e.is_async(i)){await i();break}i();break}this.is_running=!1}}class n extends i{static __;constructor(){super(),n.__=this}}class a{el;constructor(t){this.el=t}outerHTML=t=>{this.el&&(this.el.outerHTML=t)};innerHTML=t=>(this.el&&(this.el.innerHTML=t),this);innerText=t=>(this.el&&this.el instanceof HTMLElement&&(this.el.innerText=t),this);textContent=t=>(this.el&&(this.el.textContent=t),this);value=t=>(this.el&&this.el instanceof HTMLInputElement&&(this.el.value=t),this);styles=t=>{if(this.el&&this.el instanceof HTMLElement)for(const e in t)this.el.style[e]=t[e];return this};classList=t=>{if(this.el)for(const e in t)for(let i=0;i<t[e].length;i++)this.el.classList[e](t[e][i]);return this};append=t=>(this.el&&this.el.appendChild(t),this);prepend=t=>(this.el&&this.el.prepend(t),this);before=t=>{if(this.el){if(!this.el.parentNode)return;this.el.parentNode.insertBefore(t,this.el)}return this};after=t=>(this.el&&this.el.insertAdjacentElement("afterend",t),this);attributes=t=>{if(this.el)if(t instanceof NamedNodeMap)for(let e=0;e<t.length;e++){const{name:i,value:n}=t[e];"true"===n?this.el.setAttribute(i,""):"false"===n?this.el.removeAttribute(i):this.el.setAttribute(i,n)}else for(const e in t){const i=t[e];!0===i?this.el.setAttribute(e,""):!1===i?this.el.removeAttribute(e):this.el.setAttribute(e,i)}return this};replace=t=>{if(this.el){if(!this.el.parentNode)return;this.el.parentNode.replaceChild(t,this.el)}};script=async t=>(this.el&&await t(this.el),this)}class r{static __;constructor(){r.__=this}is_first_hydration=!0;separator=[";"];a_controller="a-controller";a_debounce="a-debounce";debounce_default="0";controllers_default="self";a_trigger="a-trigger";a_confirm="a-confirm";trigger_default="click";lazy_trigger="lazy";lazy_identifier="a-lazy";a_loading="a-loading";a_request_path="a-path";a_view="a-view";a_timeout="a-timeout";a_method="a-method";a_partial="a-";method_default="get";a_failed_text="a-failed_text";a_failed_text_default="fetch failed";a_failed_attr="a-failed";a_token_name="a-token_name";a_token_value="a-token_value";a_value_lookup="a-val";a_keep="a-keep";load_identifier="a:load";raw_identifier="a-raw";raw_controller="raw";route_change_identifier="a:route_changes";route_change_id="a-route_change_indicator";client_reroute_key="reroute";csrf_starts_with="csrf_";atlaAS_client_request_header="atlaAS-client-from";a_on_loading_attributes="a-on_loading";notify_load=(t,e)=>{window.dispatchEvent(new CustomEvent(this.load_identifier,{detail:{affected_node:t,mode:e,is_first_hydration:this.is_first_hydration}}))}}class s{set_attributes=t=>{new a(t).attributes({id:r.__.route_change_id,ariaBusy:"true"}).styles({position:"fixed",margin:"0",padding:"0",zIndex:"9999",width:"100%",top:"0",left:"0",visibility:"hidden"})};element=()=>document.getElementById(r.__.route_change_id);static __;constructor(){this.create_progress_bar(),this.__=this}create_progress_bar=()=>{let t=this.element();if(t)return void(this.progress_bar=t);const e=document.createElement("progress");this.set_attributes(e),new a(document.body).prepend(e)}}class o{static timeout=t=>new Promise(((e,i)=>{setTimeout((()=>{i(new Error("Operation timed out"))}),t)}));static timeout_check=async(t,e)=>{let i;try{i=await Promise.race([t(),o.timeout(e)])}catch(t){i=!1}return i};static is_visible=t=>{const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)};static get_query_param=t=>new URL(`${window.location.origin}${t}`).searchParams;static push_state=t=>{t!==`${window.location.href}`&&history.pushState({},"",t)};static interprete_path=t=>{const e=/\{([^}]+)\}/g;let i;for(;null!==(i=e.exec(t));){let e=document.querySelector(`input[${r.__.a_value_lookup}='${i[1]}']`);if(e instanceof HTMLInputElement||e instanceof HTMLSelectElement){const n=e.value;t=t.replace(i[0],n)}}return t}}class _{static element_fetch=async(t,e)=>t.hasAttribute(r.__.a_timeout)?o.timeout_check((async()=>this.element_fetch_(t,e)),Number(t.getAttribute(r.__.a_timeout))):await this.element_fetch_(t,e);static element_fetch_=async(t,e)=>{try{const i=r.__;let n=t.getAttribute(i.a_method)??i.method_default;n=n.toUpperCase();const a=o.interprete_path(t.getAttribute(i.a_request_path)??"");let s,l={};if("GET"!==n){if(s=t instanceof HTMLFormElement?new FormData(t):new FormData,t.hasAttribute(i.a_token_name)&&t.hasAttribute(i.a_token_value)){const e=t.getAttribute(i.a_token_name)??"",n=t.getAttribute(i.a_token_value)??"";s.append(`${i.csrf_starts_with}${e}`,n)}l.body=s}return await _.base_fetch(a,!e||"query_only",l)}catch(t){return console.error("Fetch error:",t),"error"}};static base_fetch=async(t,e,i={},n="get")=>{const a=document.body;return a.hasAttribute(r.__.a_timeout)?o.timeout_check((async()=>this.base_fetch_(t,e,i,n)),Number(a.getAttribute(r.__.a_timeout))):await this.base_fetch_(t,e,i,n)};static base_fetch_=async(t,e,i={},n="get")=>{const a=r.__,s=o.get_query_param(t);if(i=Object.assign({method:n,Credential:"includes",headers:{[a.atlaAS_client_request_header]:window.location.href}},i),"get"===n&&"body"in i&&i.body instanceof FormData)for(const t in i.body)t.startsWith(a.csrf_starts_with)||s.append(t,i.body[t]);switch(e){case!0:o.push_state(`${t.split("?")[0]}${s.size?"?"+s.toString():""}`);break;case"query_only":o.push_state(`${window.location.origin}${window.location.pathname}${s.size?"?"+s.toString():""}`)}const _=await fetch(t,i);_.ok||console.error({response:_,request_path:t,method:n});if("application/json"===_.headers.get("Content-Type")){const t=await _.json();return t[a.client_reroute_key]&&await l.__.handle_route_change(t[a.client_reroute_key]),!1}return await _.text()}}class l{static __;constructor(){this.url=new URL(`${window.location.href}#${window.location.hash}`),l.__=this}handle_route_change=async t=>{const e=r.__;let i;if(t instanceof HTMLAnchorElement){const n=o.interprete_path(t.getAttribute(e.a_request_path)??"");if(this.url.href===n)return;this.url.href=`${window.location.origin}${n}`,n.includes("#")?this.handle_hash_change(n):i=await _.element_fetch(t,!1)}else{if(this.url.href===t)return;this.url.href=`${window.location.origin}${t}`,t.includes("#")?this.handle_hash_change(t):i=await _.base_fetch(t,!0)}i?this.render_route_change(i):this.render_failed_fetch()};url;pop_state_handle=async t=>{t.preventDefault();const e=window.location;if(this.url.href===e.href)return;const i=document.getElementById(r.__.route_change_id);if(new a(i).styles({visibility:"visible"}),this.url=new URL(`${e.href}#${e.hash}`),this.url.hash)return void this.handle_hash_change(this.url.hash);const n=await _.base_fetch(this.url.href,!1);n&&this.render_route_change(n)};handle_hash_change=t=>{if(o.push_state(`${window.location.href}#${t}`),!t)return;if("scroll_top"===t)return void window.scrollTo({top:0,behavior:"smooth"});const e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth"})};render_route_change=t=>{const e=(new DOMParser).parseFromString(t,"text/html");this.handle_head(e.head),this.handle_body(e.body),r.__.notify_load(document,"after")};attr_h_b_=(t,e)=>{const i=document[e],n=new a(i);for(let e=0;e<i.attributes.length;e++){const{name:a,value:r}=i.attributes[e];t.hasAttribute(a)?t.getAttribute(a)!==r&&n.attributes({[a]:r}):n.attributes({[a]:!1})}for(let e=0;e<t.attributes.length;e++){const{name:a,value:r}=t.attributes[e];i.hasAttribute(a)&&i.getAttribute(a)!==r&&n.attributes({[a]:r})}};handle_head=t=>{const e=document.head.querySelectorAll("script"),i=document.head;this.attr_h_b_(t,"head");const n=Array.from(t.children),a=Array.from(i.children);a.forEach((t=>{const e=t.outerHTML;let a=!1;for(let t=0;t<n.length;t++){if(n[t].outerHTML==e){a=!0;break}}a||i.removeChild(t)})),n.forEach((t=>{const e=t.outerHTML;let n=!0;for(let t=0;t<a.length;t++){if(a[t].outerHTML==e){n=!1;break}}n&&i.appendChild(t)})),this.handle_scripts("head",e)};handle_body=t=>{const e=document.body.querySelectorAll("script");this.attr_h_b_(t,"body");const i=r.__.a_keep,n=t.querySelectorAll(`[${i}]`);if(n)for(let t=0;t<n.length;t++){const e=n[t];if(e.hasAttribute(i)){const t=document.body.querySelector(`[${i}="${e.getAttribute(i)}"]`);t&&new a(e).replace(t)}}new a(document.body).innerHTML(t.innerHTML),new s,this.handle_scripts("body",e)};handle_scripts=(t,e)=>{const i=document[t],n=i.querySelectorAll(`${t} script`);if(!n)return;const a=document.createElement("div");if(e){let t="";e.forEach((e=>{t+=e.outerHTML})),a.innerHTML=t}for(let t=0;t<n.length;t++){const e=n[t];e instanceof HTMLScriptElement&&this.re_run_script(e,a,i)}a.remove()};re_run_script=(t,e,i)=>{if(t.hasAttribute("src")&&t.hasAttribute(r.__.a_keep)&&e.querySelector(`[src="${t.getAttribute("src")}"]`))return;const n=document.createElement("script");new a(n).attributes(t.attributes).innerHTML(t.innerHTML),i.appendChild(n),t.remove()};render_failed_fetch=async()=>{alert("failed to fetch new page")}}class c{constructor(t){this.methods=t}methods;register=()=>{const t=this.methods;for(const e in t)this[e]=t[e]}}class h extends c{static __;constructor(t){super(t),h.__=this,this.register()}}class u{static logic=async(t,e)=>{const i=r.__;if(t.hasAttribute(i.a_confirm)&&!confirm(t.getAttribute(i.a_confirm)??""))return;if(t.hasAttribute(i.lazy_identifier))return void await this.lazy();const n=new a(t);f.set_element_loading(n),await f.handle_on_loadings(t),await this.standard(t,e),f.set_element_loading(n,!1)};static standard=async(t,e)=>{const i=new m.__._ajax_renderer(e,t);await i.render()};static lazy=async()=>{const t=r.__,e=Array.from(document.querySelectorAll(`[${t.lazy_identifier}]`)).filter((t=>o.is_visible(t)));if(!e.length)return;let i=[];for(let n=0;n<e.length;n++){const r=e[n];i.push((async()=>{const e=new a(r);f.set_element_loading(e),await f.handle_on_loadings(r);const i=new m.__._ajax_renderer(r.getAttribute(t.a_controller)??"",r);await i.render(),f.set_element_loading(e,!1)}))}await Promise.all(i.map((async t=>await t()))).catch((t=>{console.error(t)}))}}class d{count=0;constructor(){}}class f{static default_trigger=t=>t instanceof HTMLAnchorElement?"click":t instanceof HTMLFormElement?"submit":r.__.trigger_default;static assign_event=(t,e)=>{const i=r.__,n=(t.getAttribute(i.a_trigger)??f.default_trigger(t)).split(i.separator[0]);n[0]===i.lazy_trigger&&new a(t).attributes({[i.lazy_identifier]:!0}),f.handle_trigger(t,n,e)};static handle_trigger=(t,e,i)=>{if(!t.parentElement)return;const n=e[0],a=m.__._triggers;n in a?(e.shift(),a[n](t,i,...e)):a.default(t,i,...e)};static popstate_listener=()=>{window.addEventListener("popstate",(e=>n.__.assign(new t(r.__.route_change_identifier,(async()=>{await l.__.pop_state_handle(e)})))))};static set_main_listeners=()=>{f.anchor_view(),f.form_view(),f.register_events(),r.__.is_first_hydration&&(r.__.is_first_hydration=!1)};static anchor_view=()=>{let t;for(;t=document.querySelector("a[href]");)f.set_defaults(t),new a(t).attributes({href:!1})};static form_view=()=>{let t;for(;t=document.querySelector("form[action]");){const e=new a(t);e.attributes({onsubmit:"event.preventDefault();"}),f.set_defaults(t),e.attributes({action:!1})}};static register_events=()=>{const e=r.__,i=e.a_trigger;let s;for(;s=document.querySelector(`[${e.a_trigger}]`);){const r=s,o=r.getAttribute(e.a_controller)??e.controllers_default,_=r.getAttribute(e.a_debounce)??e.debounce_default,l=new d;f.assign_event(r,((e=null,i=-1)=>(n.__.assign(new t(o,(async()=>{l.count!=i&&(await u.logic(r,o),i>=0&&l.count++)}),Number(_).valueOf())),l))),new a(s).attributes({[i]:!1}),e.notify_load(s,"after")}};static set_defaults=t=>{const e=r.__.a_trigger,i=r.__.a_method,n=r.__.a_controller,s=new a(t);let o,_={};t instanceof HTMLAnchorElement&&(_[r.__.a_request_path]=t.getAttribute("href")??""),t instanceof HTMLFormElement&&(_[r.__.a_request_path]=t.getAttribute("action")??""),t.hasAttribute(n)||(_[n]=`${r.__.controllers_default};`),t.hasAttribute(e)||(_[e]=f.default_trigger(t)),(o=t.getAttribute("method")??r.__.method_default)&&(_[i]=o),s.attributes(_)};static handle_on_loadings=async t=>{if(!t)return;const e=r.__.a_on_loading_attributes;let i;for(t.hasAttribute(e)&&await this.handle_on_loading_single(t);i=t.querySelector(`[${e}]`);)await this.handle_on_loading_single(i)};static handle_on_loading_single=async t=>{const e=r.__.a_on_loading_attributes,i=new a(t),n=t.getAttribute(e)??"",s=h.__[n]??window[e][n];s&&await s(i)};static set_element_loading=(t,e=!0)=>{e?t.attributes({[r.__.a_loading]:!0}):t.attributes({[r.__.a_loading]:!1})}}class m{static __;_ajax_renderer;__progress_bar;_triggers;constructor(t,e,i,a,r,s){new t,this._ajax_renderer=e,this._triggers=a,new n,new l,this.__progress_bar=new i,m.__=this}run=()=>{f.popstate_listener();const t=f.set_main_listeners;window.addEventListener(r.__.load_identifier,t),t()}}class g extends c{static __;constructor(t){super(t),this.methods=t,g.__=this,this.register()}}class w{static lazy_tick=(t,e,...i)=>{w.lazy(t,(()=>w.tick(t,e,...i)))};static lazy=(t,e)=>{const i=new IntersectionObserver((n=>{n.forEach((async n=>{n.isIntersecting&&(e(),i.unobserve(t))}))}));i.observe(t);const n=new MutationObserver((()=>{i.disconnect(),n.disconnect()}));n.observe(t.parentElement,{childList:!0})};static tick=(t,e,...i)=>{let[n,a]=i,r=Number(a)??1;const s=setInterval((()=>{e(null,r).count!=r&&t.parentElement||clearInterval(s)}),new Number(n).valueOf())};static default=(t,e,...i)=>{t.addEventListener(i[0],e),new MutationObserver((()=>{t.parentElement||t.removeEventListener(i[0],e)}))}}const b=new h({}),p=new g({});new m(r,class{controller;element;constructor(t,e){this.controller=t,this.element=e}render=async()=>{const t=r.__;if(this.element instanceof HTMLAnchorElement&&!this.element.hasAttribute(t.a_partial)){const e=document.getElementById(t.route_change_id);return e&&new a(e).styles({visibility:"visible"}),void await l.__.handle_route_change(this.element)}await this.controll()};controll=async()=>{const t=r.__,e=this.controller.split(t.separator[0]);switch(e[0]){case t.controllers_default:return void await this.handle_view(this.element);case t.raw_controller:const i=await fetch(this.element.getAttribute(t.a_request_path)??""),n=g.__[e[1]]??window[t.raw_identifier][e[1]];return void(n&&await n(await i.text(),new a(this.element)))}for(let i=0;i<e.length;i++){const n=e[i];if(""===n)continue;const a=document.querySelectorAll(`[${t.a_view}*="{${n}}"]`);if(a){let t=[];for(let e=0;e<a.length;e++){const i=a[e];t.push((async()=>{await this.handle_view(i)}))}await Promise.all(t.map((async t=>await t()))).catch((t=>{console.error(t)}))}}};handle_view=async t=>{const e=new a(t);f.set_element_loading(e),await f.handle_on_loadings(t);const i=await _.element_fetch(t,!0);"string"==typeof i?(new a(t).outerHTML(i),r.__.notify_load(t,"before")):this.render_failed_fetch(t),f.set_element_loading(e,!1)};render_failed_fetch=async t=>{const e=r.__;new a(t).attributes({[e.a_failed_attr]:!0}).innerText(t.getAttribute(e.a_failed_text)??e.a_failed_text_default)}},s,w,b,p).run();
